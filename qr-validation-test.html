<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒç»´ç éªŒè¯æœºåˆ¶æµ‹è¯• - ä¸­æ’åˆ›ä¸–ç§‘æŠ€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 900;
        }
        
        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4c1d95;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .flow-step {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 15px;
            border-left: 5px solid #4c1d95;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #4c1d95;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .step-desc {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .code-block {
            background: #1f2937;
            color: #e5e7eb;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .highlight {
            background: #fbbf24;
            color: #1f2937;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .status-good {
            color: #10b981;
            font-weight: bold;
        }
        
        .status-bad {
            color: #ef4444;
            font-weight: bold;
        }
        
        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .test-card.success {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .test-card.error {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .test-card.warning {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        
        .qr-code {
            margin: 15px 0;
        }
        
        .qr-code img {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-primary {
            background: #4c1d95;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5b21b6;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .comparison-table th {
            background: #f8fafc;
            font-weight: bold;
            color: #374151;
        }
        
        .comparison-table .old {
            background: #fef2f2;
        }
        
        .comparison-table .new {
            background: #f0fdf4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” äºŒç»´ç éªŒè¯æœºåˆ¶æµ‹è¯•</h1>
            <p>ä¸­æ’åˆ›ä¸–ç§‘æŠ€ - æœåŠ¡ç«¯é¡¹ç›®è¯†åˆ«ç³»ç»Ÿ</p>
        </div>

        <!-- é—®é¢˜åˆ†æ -->
        <div class="section">
            <div class="section-title">
                ğŸš¨ åŸæœ‰é—®é¢˜åˆ†æ
            </div>
            
            <div class="flow-step">
                <div class="step-number">âŒ</div>
                <div class="step-content">
                    <div class="step-title">å‰ç«¯æœ¬åœ°å­˜å‚¨é—®é¢˜</div>
                    <div class="step-desc">é¡¹ç›®æ•°æ®ä»…å­˜å‚¨åœ¨å•†å®¶æµè§ˆå™¨çš„localStorageä¸­ï¼Œç”¨æˆ·æ‰«ç æ— æ³•è·å–</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">âŒ</div>
                <div class="step-content">
                    <div class="step-title">æ•°æ®éš”ç¦»é—®é¢˜</div>
                    <div class="step-desc">æ¯ä¸ªç”¨æˆ·è®¾å¤‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å…±äº«çš„é¡¹ç›®æ•°æ®åº“</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">âŒ</div>
                <div class="step-content">
                    <div class="step-title">éªŒè¯æœºåˆ¶ç¼ºå¤±</div>
                    <div class="step-desc">æ— æ³•éªŒè¯äºŒç»´ç çš„æœ‰æ•ˆæ€§å’Œé¡¹ç›®çŠ¶æ€</div>
                </div>
            </div>
        </div>

        <!-- æ–°è§£å†³æ–¹æ¡ˆ -->
        <div class="section">
            <div class="section-title">
                âœ… æ–°è§£å†³æ–¹æ¡ˆï¼šæœåŠ¡ç«¯é¡¹ç›®æ•°æ®åº“
            </div>
            
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">é¡¹ç›®æœåŠ¡å•ä¾‹</div>
                    <div class="step-desc">åˆ›å»ºProjectServiceå•ä¾‹ï¼Œç®¡ç†æ‰€æœ‰é¡¹ç›®æ•°æ®</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">äºŒç»´ç éªŒè¯</div>
                    <div class="step-desc">validateProjectId() éªŒè¯é¡¹ç›®IDæœ‰æ•ˆæ€§å’ŒçŠ¶æ€</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">å¼‚æ­¥æ•°æ®åŠ è½½</div>
                    <div class="step-desc">ç”¨æˆ·æ‰«ç åå¼‚æ­¥åŠ è½½é¡¹ç›®æ•°æ®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">è®¿é—®æ—¥å¿—è®°å½•</div>
                    <div class="step-desc">è®°å½•ç”¨æˆ·è®¿é—®ç»Ÿè®¡ï¼ˆåŒ¿åï¼‰ï¼Œä¾¿äºåˆ†æå’Œä¼˜åŒ–</div>
                </div>
            </div>
        </div>

        <!-- æŠ€æœ¯å®ç°å¯¹æ¯” -->
        <div class="section">
            <div class="section-title">
                ğŸ”§ æŠ€æœ¯å®ç°å¯¹æ¯”
            </div>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>åŠŸèƒ½</th>
                        <th>åŸæœ‰å®ç°</th>
                        <th>æ–°å®ç°</th>
                        <th>æ”¹è¿›æ•ˆæœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>é¡¹ç›®æ•°æ®å­˜å‚¨</strong></td>
                        <td class="old">localStorageï¼ˆå‰ç«¯ï¼‰</td>
                        <td class="new">ProjectServiceï¼ˆæœåŠ¡ç«¯æ¨¡æ‹Ÿï¼‰</td>
                        <td class="status-good">âœ… å…¨å±€å…±äº«</td>
                    </tr>
                    <tr>
                        <td><strong>äºŒç»´ç éªŒè¯</strong></td>
                        <td class="old">ç®€å•æŸ¥æ‰¾ projects.find()</td>
                        <td class="new">validateProjectId() å®Œæ•´éªŒè¯</td>
                        <td class="status-good">âœ… çŠ¶æ€æ£€æŸ¥</td>
                    </tr>
                    <tr>
                        <td><strong>é”™è¯¯å¤„ç†</strong></td>
                        <td class="old">é¡¹ç›®ä¸å­˜åœ¨æ˜¾ç¤ºé€šç”¨é”™è¯¯</td>
                        <td class="new">è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®</td>
                        <td class="status-good">âœ… ç”¨æˆ·å‹å¥½</td>
                    </tr>
                    <tr>
                        <td><strong>åŠ è½½çŠ¶æ€</strong></td>
                        <td class="old">åŒæ­¥åŠ è½½ï¼Œæ— çŠ¶æ€æç¤º</td>
                        <td class="new">å¼‚æ­¥åŠ è½½ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»</td>
                        <td class="status-good">âœ… ä½“éªŒä¼˜åŒ–</td>
                    </tr>
                    <tr>
                        <td><strong>è®¿é—®ç»Ÿè®¡</strong></td>
                        <td class="old">æ— ç»Ÿè®¡åŠŸèƒ½</td>
                        <td class="new">åŒ¿åè®¿é—®æ—¥å¿—è®°å½•</td>
                        <td class="status-good">âœ… æ•°æ®åˆ†æ</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æ ¸å¿ƒä»£ç å±•ç¤º -->
        <div class="section">
            <div class="section-title">
                ğŸ’» æ ¸å¿ƒä»£ç å®ç°
            </div>
            
            <h4>1. é¡¹ç›®éªŒè¯é€»è¾‘</h4>
            <div class="code-block">
// éªŒè¯é¡¹ç›®IDæ˜¯å¦æœ‰æ•ˆï¼ˆäºŒç»´ç éªŒè¯ï¼‰
public async validateProjectId(projectId: string): Promise&lt;{
  valid: boolean;
  project?: ProductProject;
  error?: string;
}&gt; {
  const project = this.projects.get(projectId);
  
  if (!project) {
    return {
      valid: false,
      error: 'é¡¹ç›®ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤'
    };
  }

  if (project.status !== ProjectStatus.ACTIVE) {
    return {
      valid: false,
      error: 'é¡¹ç›®å·²æš‚åœæœåŠ¡'
    };
  }

  return {
    valid: true,
    project: project
  };
}
            </div>
            
            <h4>2. ç”¨æˆ·ç«¯é¡¹ç›®åŠ è½½</h4>
            <div class="code-block">
// ä»æœåŠ¡ç«¯åŠ è½½é¡¹ç›®æ•°æ®
useEffect(() => {
  const loadProject = async () => {
    try {
      setProjectLoading(true);
      
      // <span class="highlight">éªŒè¯é¡¹ç›®IDå¹¶è·å–é¡¹ç›®æ•°æ®</span>
      const validation = await projectService.validateProjectId(projectId);
      
      if (!validation.valid) {
        setProjectError(validation.error || 'é¡¹ç›®éªŒè¯å¤±è´¥');
        return;
      }

      setProject(validation.project!);
      
      // <span class="highlight">è®°å½•ç”¨æˆ·è®¿é—®ï¼ˆåŒ¿åç»Ÿè®¡ï¼‰</span>
      await projectService.logUserAccess(projectId, {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        referrer: document.referrer
      });
      
    } catch (error) {
      setProjectError('åŠ è½½é¡¹ç›®ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    } finally {
      setProjectLoading(false);
    }
  };

  loadProject();
}, [projectId]);
            </div>
        </div>

        <!-- æµ‹è¯•ç”¨ä¾‹ -->
        <div class="section">
            <div class="section-title">
                ğŸ§ª äºŒç»´ç éªŒè¯æµ‹è¯•
            </div>
            
            <div class="test-grid" id="test-grid">
                <!-- æµ‹è¯•ç”¨ä¾‹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç”¨æˆ·æµç¨‹éªŒè¯ -->
        <div class="section">
            <div class="section-title">
                ğŸ‘¤ ç”¨æˆ·æ‰«ç æµç¨‹éªŒè¯
            </div>
            
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">ç”¨æˆ·æ‰«æäºŒç»´ç </div>
                    <div class="step-desc">äºŒç»´ç åŒ…å«é¡¹ç›®IDï¼š/view/{projectId}</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">ç³»ç»ŸéªŒè¯é¡¹ç›®ID</div>
                    <div class="step-desc">è°ƒç”¨ projectService.validateProjectId() éªŒè¯</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">åŠ è½½é¡¹ç›®æ•°æ®</div>
                    <div class="step-desc">è·å–é¡¹ç›®é…ç½®ã€çŸ¥è¯†åº“ã€AIè®¾ç½®ç­‰</div>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">å¯åŠ¨AIæœåŠ¡</div>
                    <div class="step-desc">åŸºäºé¡¹ç›®é…ç½®æä¾›ä¸ªæ€§åŒ–AIå®¢æœ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
        function generateTestCases() {
            const testCases = [
                {
                    id: 'p1',
                    name: 'æµ‹è¯•é¡¹ç›®',
                    status: 'valid',
                    description: 'æœ‰æ•ˆçš„æµ‹è¯•é¡¹ç›®'
                },
                {
                    id: 'proj_1',
                    name: 'SmartHome Pro Hub',
                    status: 'valid',
                    description: 'æœ‰æ•ˆçš„æ™ºèƒ½å®¶å±…é¡¹ç›®'
                },
                {
                    id: 'proj_2',
                    name: 'SmartThermostat',
                    status: 'valid',
                    description: 'æœ‰æ•ˆçš„æ¸©æ§ç³»ç»Ÿé¡¹ç›®'
                },
                {
                    id: 'invalid_123',
                    name: 'ä¸å­˜åœ¨çš„é¡¹ç›®',
                    status: 'invalid',
                    description: 'æ— æ•ˆçš„é¡¹ç›®ID'
                },
                {
                    id: 'expired_456',
                    name: 'å·²è¿‡æœŸé¡¹ç›®',
                    status: 'expired',
                    description: 'é¡¹ç›®å·²æš‚åœæœåŠ¡'
                }
            ];

            const testGrid = document.getElementById('test-grid');
            
            testCases.forEach(testCase => {
                const port = window.location.port ? `:${window.location.port}` : '';
                const baseUrl = `${window.location.protocol}//${window.location.hostname}${port}${window.location.pathname}`;
                const testUrl = `${baseUrl}#/view/${testCase.id}`;
                const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(testUrl)}&color=4c1d95&bgcolor=ffffff`;
                
                let cardClass = 'test-card';
                let statusText = '';
                let statusClass = '';
                
                switch (testCase.status) {
                    case 'valid':
                        cardClass += ' success';
                        statusText = 'âœ… æœ‰æ•ˆ';
                        statusClass = 'status-good';
                        break;
                    case 'invalid':
                        cardClass += ' error';
                        statusText = 'âŒ æ— æ•ˆ';
                        statusClass = 'status-bad';
                        break;
                    case 'expired':
                        cardClass += ' warning';
                        statusText = 'âš ï¸ å·²è¿‡æœŸ';
                        statusClass = 'status-warning';
                        break;
                }
                
                const testCard = document.createElement('div');
                testCard.className = cardClass;
                testCard.innerHTML = `
                    <h4>${testCase.name}</h4>
                    <p class="${statusClass}">${statusText}</p>
                    <p style="font-size: 0.9rem; color: #6b7280; margin: 10px 0;">${testCase.description}</p>
                    <div class="qr-code">
                        <img src="${qrImageUrl}" alt="QR Code for ${testCase.name}" />
                    </div>
                    <p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 15px;">ID: ${testCase.id}</p>
                    <div>
                        <a href="${testUrl}" class="btn ${testCase.status === 'valid' ? 'btn-success' : testCase.status === 'invalid' ? 'btn-danger' : 'btn-primary'}" target="_blank">
                            æµ‹è¯•æ‰«ç 
                        </a>
                    </div>
                `;
                testGrid.appendChild(testCard);
            });
        }

        // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
        window.onload = function() {
            generateTestCases();
        };
    </script>
</body>
</html>